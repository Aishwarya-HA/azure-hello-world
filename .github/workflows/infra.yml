name: iac - azurerm v4 hello world

permissions:
  id-token: write
  contents: read

on:
  push:
    branches: ["main"]               # change if your default branch is different, or remove this block
    # If you're not sure about paths, it's safer to remove the 'paths' filter entirely.
    # Keeping only the workflow path so edits to this file also trigger:
    paths:
      - ".github/workflows/*.yml"
      # If your TF files live at the repo root, you can optionally include:
      # - "*.tf"
      # - "**/*.tf"
  pull_request:
    branches: ["main"]
    paths:
      - ".github/workflows/*.yml"
      # - "*.tf"
      # - "**/*.tf"
  workflow_dispatch: {}

env:
  # The folder that contains your Terraform root module (where main.tf is).
  # From your error, 'infra/' does NOT exist, so default to repo root (".").
  TF_DIR: "."
  TF_VERSION: "1.6.6"                # set the version you need

jobs:
  plan:
    name: Terraform Plan
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Keep this until everything works; it confirms where the .tf files are
      - name: Debug â€“ show TF files
        run: |
          echo "PWD: $PWD"
          ls -la
          echo "---- find Terraform files ----"
          find . -maxdepth 4 -type f -name "*.tf" -print || true

